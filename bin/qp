#!/usr/bin/env php
<?php
ini_set('display_errors', 1);
putenv('QP_SCRIPT=');
$found = 0;
$autoloaders = array(
  dirname(__DIR__) . DIRECTORY_SEPARATOR . 'vendor' . DIRECTORY_SEPARATOR . 'autoload.php',
  dirname(dirname(dirname(__DIR__))) . DIRECTORY_SEPARATOR . 'autoload.php'
);
foreach ($autoloaders as $autoloader) {
  if (file_exists($autoloader)) {
    require_once $autoloader;
    $found = 1;
    break;
  }
}
if (!$found) {
  die("Failed to find autoloader");
}

function qp_main(\Qp\QpInput $input) {
  $actions = [
    'run' => new \Qp\Command\RunCommand(),
    'help' => new \Qp\Command\HelpCommand(),
  ];
  if (isset($actions[$input->action])) {
    $exit = $actions[$input->action]->run($input);
    exit($exit === NULL ? 0 : $exit);
  }
  else {
    $actions['help']->run($input);
    return 1;
  }
}

qp_main(\Qp\QpInput::create($argv));
